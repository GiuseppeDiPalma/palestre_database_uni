DROP TABLE SVOLTO_CON CASCADE CONSTRAINT;
DROP TABLE COMPOSTO_DA CASCADE CONSTRAINT;
DROP TABLE FREQUENTA CASCADE CONSTRAINT;
DROP TABLE E_ISCRITTO CASCADE CONSTRAINT;
DROP TABLE SCHEDA CASCADE CONSTRAINT;
DROP TABLE MISURAZIONE CASCADE CONSTRAINT;
DROP TABLE CORSO CASCADE CONSTRAINT;
DROP TABLE PERSONAL_TRAINER CASCADE CONSTRAINT;
DROP TABLE SEDE CASCADE CONSTRAINT;
DROP TABLE ATTREZZO;
DROP TABLE ESERCIZIO;
DROP TABLE PALESTRA;
DROP TABLE CERTIFICATO_MEDICO;
DROP TABLE CLIENTE;
--------------------------
--	FINE PULITURA		--
--------------------------

CREATE TABLE CLIENTE(
CODICE_TESSERA    CHAR(8) PRIMARY KEY,
NOME_CLIENTE      VARCHAR2(15) NOT NULL,
COGNOME_CLIENTE   VARCHAR2(15) NOT NULL,
SESSO			  CHAR(1),
DATA_NASCITA_CLIENTE	DATE,
ETA_CLIENTE				NUMBER(2,0),
CONSTRAINT CHECK_SESSO CHECK(SESSO IN ('M','F'))
);

CREATE TABLE CERTIFICATO_MEDICO(
ID_CERTIFICATO    NUMBER PRIMARY KEY,
DATA_SCADENZA 	  DATE NOT NULL,
NOME_MEDICO		  VARCHAR2(15) NOT NULL,
COGNOME_MEDICO	  VARCHAR2(15) NOT NULL,
M_CODICE_TESSERA CHAR(8) NOT NULL,
CONSTRAINT  FK_CODICE_TESSERA FOREIGN KEY (M_CODICE_TESSERA) REFERENCES CLIENTE(CODICE_TESSERA)
);

CREATE TABLE PALESTRA(
PARTITA_IVA			CHAR(11) PRIMARY KEY,
NOME_PALESTRA		VARCHAR2(15) NOT NULL
);

CREATE TABLE ESERCIZIO(
ID_ESERCIZIO	NUMBER PRIMARY KEY,
NOME_ESERCIZIO	VARCHAR2(20) NOT NULL
);

CREATE TABLE ATTREZZO(
ID_ATTREZZO		NUMBER PRIMARY KEY,
NOME_ATTREZZO	VARCHAR2(15) NOT NULL
);

CREATE TABLE SEDE(
STRADA		VARCHAR2(30) NOT NULL,
CITTA		VARCHAR2(20) NOT NULL,
CAP			NUMBER NOT NULL,
NUMERO_SALE	NUMBER,
M_PARTITA_IVA	CHAR(11),
PRIMARY KEY(STRADA, CITTA, CAP),
CONSTRAINT FK_PARTITA_IVA FOREIGN KEY (M_PARTITA_IVA) REFERENCES  PALESTRA(PARTITA_IVA)
);

CREATE TABLE PERSONAL_TRAINER(
ID_TESSERINO	NUMBER PRIMARY KEY,
NOME_TRAINER	VARCHAR2(15),
COGNOME_TRAINER	VARCHAR(15) NOT NULL,
DATA_NASCITA_TRAINER	DATE NOT NULL,
STIPENDIO		NUMBER,
ETA_TRAINER		NUMBER(2.0),
M_PARTITA_IVA	CHAR(11),
CONSTRAINT FK_PARTITA_IVA2 FOREIGN KEY (M_PARTITA_IVA) REFERENCES PALESTRA(PARTITA_IVA)
);


CREATE TABLE CORSO(
ID_CORSO	NUMBER PRIMARY KEY,
NOME_CORSO	VARCHAR2(15) NOT NULL,
DATA_INIZIO	DATE NOT NULL,
DATA_FINE	DATE,
M_STRADA VARCHAR2(30) NOT NULL,
M_CITTA	 VARCHAR2(20) NOT NULL, 
M_CAP	 NUMBER,
M_ID_TESSERINO	NUMBER,
M_PARTITA_IVA	CHAR(11),
CONSTRAINT FK_STRADA FOREIGN KEY (M_STRADA, M_CITTA, M_CAP) REFERENCES SEDE(STRADA, CITTA, CAP),
CONSTRAINT FK_ID_TESSERINO1 FOREIGN KEY (M_ID_TESSERINO) REFERENCES PERSONAL_TRAINER(ID_TESSERINO),
CONSTRAINT FK_PARTITA_IVA3 FOREIGN KEY (M_PARTITA_IVA) REFERENCES PALESTRA(PARTITA_IVA)
);

CREATE TABLE MISURAZIONE(
DATA_MISURAZIONE	DATE,
ADDOME				NUMBER,
COSCE				NUMBER,
BICIPITI			NUMBER,
SPALLE				NUMBER,
PESO				NUMBER,
ALTEZZA				NUMBER,
IMC					NUMBER,
M_ID_TESSERINO		NUMBER,
M_CODICE_TESSERA	CHAR(8),
CONSTRAINT FK_ID_TESSERINO2 FOREIGN KEY (M_ID_TESSERINO) REFERENCES PERSONAL_TRAINER(ID_TESSERINO),
CONSTRAINT FK_CODICE_TESSERA2 FOREIGN KEY (M_CODICE_TESSERA) REFERENCES CLIENTE(CODICE_TESSERA),
PRIMARY KEY(DATA_MISURAZIONE, M_CODICE_TESSERA)
);

CREATE TABLE SCHEDA(
DATA_INIZIO		DATE,
G_SETTIMANALI		NUMBER,
M_CODICE_TESSERA	CHAR(8),
M_ID_TESSERINO		NUMBER,
PRIMARY KEY(DATA_INIZIO, M_CODICE_TESSERA),
CONSTRAINT FK_CODICE_TESSERA3 FOREIGN KEY (M_CODICE_TESSERA) REFERENCES CLIENTE(CODICE_TESSERA),
CONSTRAINT FK_ID_TESSERINO3 FOREIGN KEY (M_ID_TESSERINO) REFERENCES PERSONAL_TRAINER(ID_TESSERINO)
);

CREATE TABLE E_ISCRITTO(
DATA_ISCRIZIONE		DATE NOT NULL,
M_CODICE_TESSERA	CHAR(8),
M1_PARTITA_IVA		CHAR(11),
CONSTRAINT E_ISCRITTO_PK PRIMARY KEY (M_CODICE_TESSERA, M1_PARTITA_IVA),
CONSTRAINT FK_CODICE_TESSERA4 FOREIGN KEY (M_CODICE_TESSERA) REFERENCES CLIENTE(CODICE_TESSERA),
CONSTRAINT FK_PARTITA_IVA4	FOREIGN KEY (M1_PARTITA_IVA) REFERENCES PALESTRA(PARTITA_IVA)
);

CREATE TABLE FREQUENTA(
M_ID_CORSO			NUMBER,
M_CODICE_TESSERA	CHAR(8),
DATA_PRESENZA		DATE,
CONSTRAINT FREQUENTA_PK	PRIMARY KEY (M_ID_CORSO, M_CODICE_TESSERA),
CONSTRAINT FK_ID_CORSO FOREIGN KEY (M_ID_CORSO) REFERENCES CORSO(ID_CORSO),
CONSTRAINT FK_CODICE_TESSERA5 FOREIGN KEY (M_CODICE_TESSERA) REFERENCES CLIENTE(CODICE_TESSERA)
);

CREATE TABLE COMPOSTO_DA(
M_ID_ESERCIZIO		NUMBER,
M_DATA_INIZIO		DATE NOT NULL,
M_CODICE_TESSERA2	CHAR(8),
PESO_KG				NUMBER NOT NULL,
RIPETIZIONI			NUMBER,
SERIE 				NUMBER,
CONSTRAINT FK_COMPOSTO_DA PRIMARY KEY (M_ID_ESERCIZIO, M_DATA_INIZIO),
CONSTRAINT FK_ID_ESERCIZIO FOREIGN KEY (M_ID_ESERCIZIO) REFERENCES ESERCIZIO(ID_ESERCIZIO),
CONSTRAINT FK_DATA_INIZIO FOREIGN KEY (M_DATA_INIZIO, M_CODICE_TESSERA2 ) REFERENCES SCHEDA(DATA_INIZIO, M_CODICE_TESSERA)
);

CREATE TABLE SVOLTO_CON(
M_ID_ATTREZZO		NUMBER,
M_ID_ESERCIZIO		NUMBER,
CONSTRAINT FK_SVOLTO_CON PRIMARY KEY (M_ID_ATTREZZO, M_ID_ESERCIZIO),
CONSTRAINT FK_ID_ATTREZZO FOREIGN KEY (M_ID_ATTREZZO) REFERENCES ATTREZZO(ID_ATTREZZO),
CONSTRAINT FK_ID_ESERCIZIO2 FOREIGN KEY (M_ID_ESERCIZIO) REFERENCES ESERCIZIO(ID_ESERCIZIO)
);